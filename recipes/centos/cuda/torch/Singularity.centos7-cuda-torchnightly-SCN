#Bootstrap: shub
#From: coreyjadams/larcv2-singularity:centos7-cuda-torchnightly

Bootstrap: localimage
From: /home/cadams/DeepLearnPhysics/larcv2-singularity/centos7-cuda-torchnightly

%help
Centos7 with cuda9.0 cudnn7
ML/DL packages  : tensorflow keras sc-learn submanifold-sparse-convolutional-networks
Sci.  packages  : numpy pandas sc-image matplotlib opencv-python
Basic python    : ipython jupyter yaml pygments six zmq wheel h5py tqdm 
Development kit : g++/gcc cython nvcc libqt4-dev python-dev
Utility kit     : git wget emacs vim openssh-client

To start your container simply try
singularity exec THIS_CONTAINER.simg bash

To use GPUs, try
singularity exec --nv THIS_CONTAINER.simg bash

%labels
Maintainer coreyjadams
Version centos7-cuda-torchnightly-SCN

#------------
# Global installation
#------------
%environment
    
%post

    scl enable devtoolset-4 bash
    
    # Using the app area to store software:
    mkdir /app
    cd /app

    # Install the necessary hash functions:
    git clone https://github.com/sparsehash/sparsehash.git
    cd sparsehash
    ./configure
    make -j install


    # This installs the sparse conv net wheel that I built by hand.  It's a hack.

    pip install /data1/cadams/dist/sparseconvnet-0.2-cp27-cp27mu-linux_x86_64.whl